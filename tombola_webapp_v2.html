
<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>LÃ¥ttombola</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2em;
      background: #f8f8f8;
    }
    h1 {
      font-size: 1.5em;
    }
    .filters {
      margin-bottom: 1em;
    }
    .result {
      margin-top: 1.5em;
      padding: 1em;
      background: #fff;
      border: 1px solid #ccc;
    }
    label {
      display: block;
      margin-bottom: 0.5em;
    }
    select, button {
      padding: 0.5em;
      font-size: 1em;
    }
    .debug {
      font-size: 0.9em;
      color: #666;
      margin-top: 1em;
    }
  </style>
</head>
<body>

<h1>ðŸŽ¸ LÃ¥ttombola</h1>

<div class="filters">
  <label>
    Repad:
    <select id="repadFilter">
      <option value="">(alla)</option>
      <option value="NEJ">NEJ</option>
      <option value="HALVREPAD">HALVREPAD</option>
      <option value="JA">JA</option>
    </select>
  </label>

  <label>
    Max PRIO (1â€“5):
    <select id="prioFilter">
      <option value="">(alla)</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
    </select>
  </label>

  <label>
    Tempo:
    <select id="tempoFilter">
      <option value="">(alla)</option>
      <option value="EPIC">EPIC</option>
      <option value="SNABB">SNABB</option>
      <option value="LUGN">LUGN</option>
      <option value="MELLAN">MELLAN</option>
      <option value="Ã–SIG">Ã–SIG</option>
    </select>
  </label>

  <label>
    Endast lÃ¥nga lÃ¥tar? (Ã¶ver 3:30)
    <input type="checkbox" id="longOnly">
  </label>

  <label>
    Album att inkludera:
    <input type="text" id="albumFilter" placeholder="LÃ¤mna tomt fÃ¶r alla">
  </label>

  <button onclick="slumpaLÃ¥t()">ðŸŽ² Slumpa lÃ¥t</button>
</div>

<div class="result" id="result"></div>
<div class="debug" id="debugInfo"></div>

<script>
let lÃ¥tdata = [];

fetch('tombola_data.json')
  .then(res => res.json())
  .then(data => {
    // Trim all string fields
    lÃ¥tdata = data.map(lÃ¥t => ({
      ...lÃ¥t,
      repad: lÃ¥t.repad?.trim(),
      tempo: lÃ¥t.tempo?.trim(),
      album: lÃ¥t.album?.trim()
    }));
  });

function slumpaLÃ¥t() {
  const repad = document.getElementById('repadFilter').value;
  const prio = document.getElementById('prioFilter').value;
  const tempo = document.getElementById('tempoFilter').value;
  const longOnly = document.getElementById('longOnly').checked;
  const album = document.getElementById('albumFilter').value.toLowerCase();

  let filtrerat = lÃ¥tdata.filter(lÃ¥t => {
    return (!repad || lÃ¥t.repad === repad) &&
           (!prio || parseInt(lÃ¥t.prio) <= parseInt(prio)) &&
           (!tempo || lÃ¥t.tempo === tempo) &&
           (!longOnly || lÃ¥t.langd_sek > 210) &&
           (!album || (lÃ¥t.album && lÃ¥t.album.toLowerCase().includes(album)));
  });

  document.getElementById('debugInfo').innerText = `ðŸ”Ž Filtrerade lÃ¥tar: ${filtrerat.length}`;

  if (filtrerat.length === 0) {
    document.getElementById('result').innerHTML = "ðŸš« Inga lÃ¥tar matchar dina filter.";
    return;
  }

  const slumpad = filtrerat[Math.floor(Math.random() * filtrerat.length)];

  document.getElementById('result').innerHTML = `
    <strong>${slumpad.titel}</strong><br>
    Album: ${slumpad.album}<br>
    Tempo: ${slumpad.tempo}<br>
    PRIO: ${slumpad.prio}<br>
    Repad: ${slumpad.repad}<br>
    LÃ¤ngd: ${slumpad.langd}
  `;
}
</script>

</body>
</html>
